# Displaced Vertex Recasting #

## Authors: ##
[Andre Lessa](mailto:andre.lessa@ufabc.edu.br)

This repository holds the main code for recasting the 13 TeV ATLAS search for displaced vertices
 ([ATLAS-SUSY-2018-13](https://atlas.web.cern.ch/Atlas/GROUPS/PHYSICS/PAPERS/SUSY-2018-13/))
using the efficiency grids  for event and vertex reconstruction selection provided [here](https://atlas.web.cern.ch/Atlas/GROUPS/PHYSICS/PAPERS/SUSY-2018-13/hepdata_info.pdf).

## Pre-Requisites ##

The following pre-requisites must be installed before compiling the main code:

  * [MadGraph5](https://launchpad.net/mg5amcnlo) with [Pythia8](https://pythia.org/) installed
  * [Modified Delphes](./DelphesLLP.tar.gz)
  
## Installation ##

Running:

```
./installer.sh
```

Should install most of the relevant (non-Mathematica) packages.
The LHAPDF, Pythia8 and Delphes directories must be included in the library and root include paths.
This can be done running:

```
source setenv.sh
```


## Running ##

The recasting accepts ROOT files generated by the modified Delphes version provided in this repository.
Examples of Delphes cards can be found in the [validation/Cards](./validation/Cards) folder.
The main recasting code accepts the following options:

```
usage: atlas_susy_2018_13_Recast.py [-h] -f INPUTFILE [INPUTFILE ...] [-o OUTPUTFILE] [-n] [-m MODEL] [-v VERBOSE]

Run the recasting for ATLAS-SUSY-2018-13 using one or multiple Delphes ROOT files as input. If multiple files are given as argument, add them (the samples weights will be normalized if -n is given).
Store the cutflow and SR bins in a pickle (Pandas DataFrame) file.

options:
  -h, --help            show this help message and exit
  -f INPUTFILE [INPUTFILE ...], --inputFile INPUTFILE [INPUTFILE ...]
                        path to the ROOT event file(s) generated by Delphes.
  -o OUTPUTFILE, --outputFile OUTPUTFILE
                        path to output file storing the DataFrame with the recasting data. If not defined, will use the name of the first input file
  -n, --normalize       If set, the input files will be considered to refer to multiple samples of the same process and their weights will be normalized.
  -m MODEL, --model MODEL
                        Defines which model should be considered for extracting model parameters (strong,ewk,gluino).
  -v VERBOSE, --verbose VERBOSE
                        verbose level (debug, info, warning or error). Default is info

```

where the model option is only necessary for collecting the useful model parameters (masses and lifetime)
for the user covenience. It is not needed, however, for computing the efficiencies or signal yield.
If not defined, the model parameters will not be added to the outptut.
Running:

The basic required input is a SLHA file.
For instance, running:

```
./atlas_susy_2018_13_Recast.py -f <root file>
```

will produce a pickle file contaning a Pandas DataFrame with a simplified cutflow and the number of events in each signal region.
For a more detailed cutflow, one should use:

```
usage: atlas_susy_2018_13_CutFlow.py [-h] -f INPUTFILE [INPUTFILE ...] [-o OUTPUTFILE] [-n] [-m MODEL] [-s SR] [-N NEVTS] [-v VERBOSE]

Run the recasting for ATLAS-SUSY-2018-13 using one or multiple Delphes ROOT files as input. If multiple files are given as argument, add them (the samples weights will be normalized if -n is given).
Store the cutflow and SR bins in a pickle (Pandas DataFrame) file.

options:
  -h, --help            show this help message and exit
  -f INPUTFILE [INPUTFILE ...], --inputFile INPUTFILE [INPUTFILE ...]
                        path to the ROOT event file(s) generated by Delphes.
  -o OUTPUTFILE, --outputFile OUTPUTFILE
                        path to output file storing the DataFrame with the recasting data. If not defined, will use the name of the first input file
  -n, --normalize       If set, the input files will be considered to refer to multiple samples of the same process and their weights will be normalized.
  -m MODEL, --model MODEL
                        Defines which model should be considered for extracting model parameters (strong,ewk,gluino).
  -s SR, --SR SR        Defines which signal region should be considered for the cutflow (HighPT or Trackless).
  -N NEVTS, --nevts NEVTS
                        Maximum number of events to use.
  -v VERBOSE, --verbose VERBOSE
                        verbose level (debug, info, warning or error). Default is info
```


## Validation ##

