# HSCP Recasting #

## Authors: ##
[Andre Lessa](mailto:andre.lessa@ufabc.edu.br)

This repository holds the main code for recasting the 13 TeV ATLAS heavy stable charged particle
search ([ATLAS-SUSY-2018-42](http://atlas.web.cern.ch/Atlas/GROUPS/PHYSICS/PAPERS/SUSY-2018-42/))
based on the recasting details provided [here](http://atlas.web.cern.ch/Atlas/GROUPS/PHYSICS/PAPERS/SUSY-2018-42/hepdata_info.pdf).

## Pre-Requisites and Installation ##

The following pre-requisites must be installed before compiling the main code:

  * [MadGraph5](https://launchpad.net/mg5amcnlo/)
  * [Delphes](https://cp3.irmp.ucl.ac.be/projects/delphes)[^1]
  * [Pythia8](https://pythia.org/)
  * [HepMC](http://hepmc.web.cern.ch/hepmc/)

Executing:

```
./installer.sh
```

Will try to fetch the required packages and install them in the current folder.
*Note that a modified version of Delphes should be installed using [../../Delphes_LLP/DelphesLLP.tar.gz](../../Delphes_LLP/DelphesLLP.tar.gz)*
The LHAPDF, Pythia8 and Delphes directories must be included in the library and root include paths.
This can be done running:

```
source setenv.sh
```

## Running ##

The recasting is based on the Delphes output generated by running MadGraph/Pythia/Delphes.
Note that the Delphes card must define the PDG codes for the LLPs in the LLPFilter block, so the relevant information is stored in the Delphes output. An example can be found [here](./validation/Cards/chargino/delphes_card_chargino).


The event yields and recasting info can then be obtained running:

```
./atlas_susy_2018_42_Recast.py -f <input ROOT file> -o <output file> -m <model>
```

where model is used to fetch the relevant model parameters depending on the scenario (stau, wino or gluino).
This information is used only for conveniently storing the model parameters (such as the proper lifetime) along with the recasting info.
The user can easily modify the [helper.py](./helper.py) code for other models.
The output is a pickle file containing a Pandas DataFrame with the model parameters and recasting output.


For combining results from multiple model points into a single DataFrame, run:

```
./atlas_susy_2018_42_CombineData.py -f <pickle file1> <pickle file2> ... -o <output file>
```

Finally, for computing upper limits:

```
./atlas_susy_2018_42_UpperLimits.py -f <pickle file>  -o <output file>
```

The result is again a DataFrame, but now including an upper limit column.



## Validation

The validation of the recasting code was done using the Wino (Chargino), Stau and Gluino benchmarks considered by ATLAS.

The scan over the parameter space can be conveniently done running:

```
./runScanMG5.py -p <parameters file>
```
where basic required input is defined [parameter file](./validation/scan_parameters_chargino.ini) specifying the input cards and model parameters.
The output is a Delphes ROOT file for each model point.

The MadGraph, Pythia and Delphes cards for each scenario can be found in [./validation/Cards](./validation/Cards/).
The recasting results and plotting scripts can be found in the folders: [chargino_results](./validation/chargino_results), [stau_results](./validation/stau_results) and [gluino_results](./validation/gluino_results).

## Validation ##

### Wino Scenario

A comparison between the official ATLAS 95\% C.L. exclusion curve for the wino scenario and the one obtained using this recasting code is shown below:


![Alt text](validation/chargino_results/chargino_fig17a.png?raw=true "Chargino Validation Plot")

Validation of the acceptances and efficiencies for all the benchmark points can be found in [this notebook](./validation/chargino_results/validation_CharginoTables.ipynb)

### Stau Scenario

A comparison between the official ATLAS 95\% C.L. exclusion curve for the stau scenario and the one obtained using this recasting code is shown below:


![Alt text](validation/stau_results/stau_fig17b.png?raw=true "Stau Validation Plot")

Validation of the acceptances and efficiencies for all the benchmark points can be found in [this notebook](./validation/stau_results/validation_StauTables.ipynb)


### Gluino Scenario


A comparison between the official ATLAS 95\% C.L. exclusion curve for the gluino scenario and the one obtained using this recasting code is shown below:


![Alt text](validation/stau_results/gluino_fig16a.png?raw=true "Gluino Validation Plot")

![Alt text](validation/stau_results/gluino_fig16b.png?raw=true "Gluino Validation Plot")


Validation of the acceptances and efficiencies for all the benchmark points can be found in [this notebook](./validation/stau_results/validation_GluinoTables.ipynb)


[^1]: A modified version of Delphes needs to be installed, which includes a module for filtering LLPs
      and storing their decays.  


